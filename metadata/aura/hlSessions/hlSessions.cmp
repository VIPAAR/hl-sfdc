<aura:component controller="HLSessionController" implements="flexipage:availableForRecordHome,force:hasRecordId" access="global">

    <aura:attribute name="record" type="Object"/>
    <aura:attribute name="recordError" type="String"/>
    <aura:attribute name="calls" type="HLCall__c[]"/>
    <aura:attribute name="contactIsHLUser" type="Boolean"/>

    <aura:handler name="init" action="{!c.doInit}" value="{!this}" />

    <force:recordPreview aura:id="recordLoader"
                         recordId="{!v.recordId}"
                         layoutType="FULL"
                         targetRecord="{!v.record}"
                         targetError="{!v.recordError}"
                         recordUpdated="{!c.recordUpdatedEvt}" />

    <!-- PAGE HEADER -->
    <div class="slds-page-header" role="banner">
    	<div class="slds-grid">
            <div class="slds-col">
            	<p class="slds-text-heading--label">Help Lightning</p>
                <ui:button label="{!'Call ' + v.record.Contact.Name}"
                           class="slds-button slds-button--brand"
                           press="{!c.clickCall}"
                           disabled="{!v.contactIsHLUser == false}"
                           />
            </div>
            <div class="slds-col" aura:id="hl-call-details--div">
                <p class="slds-text-heading--label">Call History</p>
                <aura:iteration items="{!v.calls}" var="call">
                    <!-- make this green if a successful completion,
                         red if unsuccessful completion, and none if in progress -->
                    <div class="{!call.Complete__c == true ?
                                (call.Successful__c == true ?
                                'slds-theme--success' : 'slds-theme--warning') : ''}">
                        <section class="slds-card__body">
                            <div id="list" class="row">
                                <p class="slds-truncate">Id: <ui:outputText title="{!call.HLCall_id__c}" value="{!call.Id}" /> </p>
                                <p>Date: <ui:outputDateTime value="{!call.Start_Time__c}" /> </p>
                                <aura:if isTrue="{!call.Complete__c}">
                                    <aura:if isTrue="{!call.Successful__c}">
                                        <p>Call Answered</p>
                                        <p>Duration: <ui:outputNumber value="{!call.Duration__c + 's'}" /> </p>
                                        <aura:set attribute="else">
                                            <p>Call Not Answered</p>
                                        </aura:set>
                                    </aura:if>
                                    <aura:set attribute="else">
                                        <p>In Call...</p>
                                    </aura:set>
                                </aura:if>
                            </div>
                        </section>
                    </div>
                </aura:iteration>
            </div>
        </div>
    </div>
    <!-- / PAGE HEADER -->
</aura:component>
