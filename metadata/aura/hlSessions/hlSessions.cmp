<aura:component controller="HLSessionController" implements="flexipage:availableForRecordHome,force:hasSObjectName,force:hasRecordId" access="global">

    <aura:attribute name="supportedComponent" type="Boolean" default="false" />
    <aura:attribute name="contact" type="Contact"/>
    <aura:attribute name="calls" type="helplightning__HLCall__c[]"/>
    <aura:attribute name="contactIsHLUser" type="Boolean"/>

    <aura:handler name="init" action="{!c.doInit}" value="{!this}" />

    <!-- Help Lightning Component -->
    <article class="slds-card">
        <div class="slds-card__header slds-grid">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <div class="slds-media__figure">
                    <span class="slds-icon_container slds-icon-standard-contact" title="Help Lightning">
                        <!-- <svg class="slds-icon slds-icon_small" aria-hidden="true"> -->
                        <!--     <use xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#contact"></use> -->
                        <!-- </svg> -->
                    </span>
                </div>
                <div class="slds-media__body">
                    <h2>
                        <a href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="Help Lightning">
                            <span class="slds-text-heading_small">Help Lightning</span>
                        </a>
                    </h2>
                </div>
            </header>
            <div class="slds-no-flex">
                <button class="slds-button slds-button_brand">Call Contact</button>
                <button class="slds-button slds-button_neutral">Invite Contact</button>
            </div>
        </div>
        <div class="slds-card__body slds-card__body_inner">
            <!-- <h3>Use Help Lightning to make mobile merged reality video calls.</h3> -->
            <!-- Activity Timeline -->
            <c:hlRecentEventTimeline calls="{!v.calls}" />
        </div>
        <footer class="slds-card__footer"></footer>
    </article>

    <!-- PAGE HEADER -->
    <div class="slds-page-header" role="banner">
        <aura:if isTrue="{!(!v.supportedComponent)}">
            <div>
                <h1>Unsupported Component!</h1>
            </div>
            <aura:set attribute="else">
    	        <div class="slds-grid">
                    <div class="slds-col">
            	        <p class="slds-text-heading--label">Help Lightning</p>
                        <div>
                            <ui:button label="{!'Call ' + v.contact.Name}"
                                       class="slds-button slds-button--brand"
                                       press="{!c.clickCall}"
                                       disabled="{!v.contactIsHLUser == false}"
                                       />
                        </div>
                        <div>
                            <ui:button label="{!'Invite ' + v.contact.Name + ' to Personal Room'}"
                                       class="slds-button slds-button--brand"
                                       press="{!c.clickInviteToPersonalRoom}"
                                       />
                        </div>
                    </div>
                    <div class="slds-col" aura:id="hl-call-details--div">
                        <p class="slds-text-heading--label">Call History</p>
                        <aura:iteration items="{!v.calls}" var="call">
                            <!-- make this green if a successful completion,
                                 red if unsuccessful completion, and none if in progress -->
                            <div class="{!call.helplightning__Complete__c == true ?
                                        (call.helplightning__Successful__c == true ?
                                        'slds-theme--success' : 'slds-theme--warning') : ''}">
                                <section class="slds-card__body">
                                    <div id="list" class="row">
                                        <p class="slds-truncate">Id: <ui:outputText title="{!call.helplightning__HLCall_id__c}" value="{!call.Id}" /> </p>
                                        <p>Date: <ui:outputDateTime value="{!call.helplightning__Start_Time__c}" /> </p>
                                        <aura:if isTrue="{!call.helplightning__Complete__c}">
                                            <aura:if isTrue="{!call.helplightning__Successful__c}">
                                                <p>Call Answered</p>
                                                <p>Duration: <ui:outputNumber value="{!call.helplightning__Duration__c + 's'}" /> </p>
                                                <aura:set attribute="else">
                                                    <p>Call Not Answered</p>
                                                </aura:set>
                                            </aura:if>
                                            <aura:set attribute="else">
                                                <p>In Call...</p>
                                            </aura:set>
                                        </aura:if>
                                    </div>
                                </section>
                            </div>
                        </aura:iteration>
                    </div>
                </div>
            </aura:set>
        </aura:if>
    </div>
    <!-- / PAGE HEADER -->
</aura:component>
